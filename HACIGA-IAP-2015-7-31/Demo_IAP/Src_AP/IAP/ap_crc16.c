/*********************************************************************************************************//**
 * @file    USBD/STD_GK/Src_AP/ap_crc16.c
 * @version V1.00
 * @date    06/14/2011
 * @brief   This file contains CRC16 algorithm.
 *************************************************************************************************************
 *
 * <h2><center>Copyright (C) 2011 Holtek Semiconductor Inc. All rights reserved</center></h2>
 *
 ************************************************************************************************************/

/* Includes ------------------------------------------------------------------------------------------------*/
#include "ap_crc16.h"

/* Private typedef -----------------------------------------------------------------------------------------*/
/* Private constants ---------------------------------------------------------------------------------------*/
#define CCITT     (0x1021)

/* Private function prototypes -----------------------------------------------------------------------------*/
static u16 _crc(u32 n);

/* Private macro -------------------------------------------------------------------------------------------*/
/* Global variables ----------------------------------------------------------------------------------------*/
/* Private variables ---------------------------------------------------------------------------------------*/
/* Global functions ----------------------------------------------------------------------------------------*/

/*********************************************************************************************************//**
  * @brief  The CRC16 algorithm.
  * @param  crc: Initial CRC value
  * @param  buffer: Start address of buffer for CRC calculation
  * @param  length: Length in byte for CRC calculation
  * @retval crc: The value of CRC16 algorithm
  ***********************************************************************************************************/
u16 CRC16(u32 crc, u8 *buffer, u32 length)
{
  u32 i, j;

  for (i = 0; i < length; i++)
  {
    j = (crc >> 8) ^ buffer[i];
    crc = (crc << 8) ^ _crc(j);
  }

  return crc;
}

/* Private functions ---------------------------------------------------------------------------------------*/

/*********************************************************************************************************//**
  * @brief  This function is used to calculate value of CRC table.
  * @param  n: Index of CRC table
  * @retval acc: The value of CRC table[n]
  ***********************************************************************************************************/
static u16 _crc(u32 n)
{
  u32 i, acc;

  for (n <<= 8, acc = 0, i = 8; i > 0; i--, n <<= 1)
  {
    acc = ((n ^ acc) & 0x8000) ? ((acc << 1) ^ CCITT) : (acc << 1);
  }

  return (u16)(acc);
}
